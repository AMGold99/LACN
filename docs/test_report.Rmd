---
title: "General Report"
output: 
  html_document:
    css: "style.css"
    theme: flatly
    toc: true
    toc_float: true
    toc_depth: 3
params:
  college: college
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

# load packages
library(tidyverse)

# load LACN analysis environment
load("../lacn.RData")
```

#### 2020-21 LACN Operations Survey {#subtitle}

<hr/>


## Introduction


### Enrollment

<div class="row">

  <div class="col-sm-7">

```{r enroll-plot}
enrollPlot(college = params$college) 
```

  </div>

  <div class="col-sm-5">

```{r enroll-table}
tableViz(enroll_data, var = "enroll")
```

  </div>

</div>


### Endowment

<div class="row">

  <div class="col-sm-7">

```{r endow-plot}
endowPlot(college = params$college) 
```

  </div>

  <div class="col-sm-5">

```{r endow-table}
tableViz(endow_data, var = "endow")
```

  </div>

</div>

<hr/>


## Reporting and Staffing

<div class="row">

### Reporting Structure

  <div class="col-sm-7">

```{r reporting-plot}

singlePlot(reporting_data, q = "Q2", college = params$college,
           string_rem = ":")

```

  </div>


  <div class="col-sm-5">

`r nTab(question_list$Q2['Institution Name'])`

  </div>

</div>

<div class="row">

### Steps Removed from President's Office

  <div class="col-sm-7">

```{r steps-plot}

  singlePlot(steps_data, q = "Q3", college = params$college,
           string_rem = "[:blank:]\\(.+\\)")

```

  </div>

<div class="col-sm-5">

`r nTab(question_list$Q3['Institution Name'])`

  </div>

</div>

### Student Staff (total)

<div class="row">

  <div class="col-sm-7">

```{r student-staff-plot}

matrixPlot(student_staff_data, college = params$college)

```

  </div>


  <div class="col-sm-5">

```{r student-staff-table}

tableViz(data = student_staff_data,'n')

```

  </div>

</div>

### Professional (FTE)

<div class="row">

  <div class="col-sm-7">

```{r prof-plot}
matrixPlot(prof_staff_data, college = params$college)
```

  </div>
  
  <div class="col-sm-5">

```{r prof-table}
tableViz(prof_staff_data, var = 'n')
```
  
  </div>
  
</div>

### Student to Professional Staff (FTE) Ratio

<div class="row">

  <div class="col-sm-7">

```{r sp-ratio-plot}

matrixPlot(student_prof_ratio, college = params$college)

```

  </div>
  
  <div class="col-sm-5">

```{r sp-ratio-table}

tableViz(student_prof_ratio, var='n')

```

  </div>
  
</div>

### Professional Staff: Advising

<div class="row">

  <div class="col-sm-7">

```{r prof-advising-plot}
matrixPlot(prof_advising_data, college = params$college)
```

  </div>
  
  <div class="col-sm-5">

```{r prof-advising-table}
tableViz(prof_advising_data, 'n')
```
  
  </div>

</div>

### Professional Staff: Employer Relations

<div class="row">

  <div class="col-sm-7">

```{r prof-employer-plot}
matrixPlot(prof_employer_data, college = params$college)
```

  </div>
  
  <div class="col-sm-5">

```{r prof-employer-table}
tableViz(prof_employer_data, 'n')
```

  </div>
  
</div>

<hr/>


## Student/Alum Engagement

### Student Engagement by Class Year

<div class="row">

  <div class="col-sm-7">

```{r sengage-year-plot}

suppressMessages(
  
question_list$Q21 |>
  tidyr::pivot_longer(
    cols = !(1:2),
    names_to = c('main','sub1','sub2'),
    values_to = "engage",
    names_sep = "_"
  ) |>
  dplyr::filter(sub2==4) |>
  dplyr::mutate(Question = paste(main,sub1,sub2, sep = "_")) |>
    dplyr::left_join(
      keyFunction('Q21',dim1)
    ) |>
  dplyr::select(!c(main:sub2,Question))  |>
  dplyr::mutate(across(`Undergraduate enrollment`:engage, as.numeric)) |>
  dplyr::group_by(dim1) |>
  dplyr::summarise(Mean = mean(engage), 
                   Median = median(engage),
                   Max = max(engage),
                   #`Your School` = mean(engage[`Institution Name`==params$college])
                   ) |>
  dplyr::mutate(dim1 = stringr::str_replace(dim1, regex("TOTAL"),"Total\n")) |>
  tidyr::pivot_longer(
    cols = !dim1,
    names_to = "measure",
    values_to = "engage"
  ) |>
  
  ggplot2::ggplot(ggplot2::aes(dim1,engage))+
  
  ggplot2::geom_hline(yintercept = c(0,25,50,75,100), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = measure),
                    position = "dodge",
                    stat = "identity")+
  ggplot2::scale_y_continuous(limits = c(0,100), breaks = c(0,25,50,75,100))+
  ggplot2::labs(
    y = "Engagement (%)",
    x = NULL
  )+
  ggplot2::scale_fill_manual(
    values=c(Max = "#2C3E50", 
             Mean = "#18BC9C",
             Median = "#F39C12"
             #, `Your School` = "#217DBB"
             )
    )+
  ggplot2::theme(
    text = ggplot2::element_text(size = 15),
    axis.ticks = ggplot2::element_blank(),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.position = "top"
    )
)
```

  </div>
  
  <div class="col-sm-5">
  
<!-- Q for Nate: what do we consider a missing value here? I'm only
considering whether they answered total engagement for "TOTAL (all classes)"--> 

`r nTab(question_list$Q21$Q21_5_4)`

\n \n Note: Engagement \n includes appointments \n w/ professional staff \n and peer advisors and \n programs and events

  </div>
  
</div>

### Student Engagement by Type of Engagement

<div class="row">

  <div class="col-sm-7">

```{r sengage-type-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r sengage-type-table}
plot(cars)
```

  </div>
  
</div>

### Professional Staff Appt w/ Students (by class year) (distribution)

<div class="row">

  <div class="col-sm-7">

```{r appt-student-dist-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r appt-student-dist-table}
plot(cars)
```

  </div>
  
</div>

### Professional Staff Appt w/ Students (by class year) (grouped bar)

<div class="row">

  <div class="col-sm-7">

```{r appt-student-group-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r appt-student-group-table}
plot(cars)
```

  </div>
  
</div>

### Professional Staff Appt w/ Alum

<div class="row">

  <div class="col-sm-7">

```{r appt-alum-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r appt-alum-table}
plot(cars)
```

  </div>
  
</div>

### Professional Staff Appt (+ email) per Total FTE

<div class="row">

  <div class="col-sm-7">

```{r appt-fte-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r appt-fte-table}
plot(cars)
```

  </div>
  
</div>

### Experiential Learning Participation

<div class="row">

  <div class="col-sm-7">

```{r exper-learning-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r exper-learning-table}
plot(cars)
```

  </div>
  
</div>

<hr/>

## Budget

### Total Available Funding

<div class="row">

  <div class="col-sm-7">

```{r total-funding-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r total-funding-table}
plot(cars)
```

  </div>
  
</div>

### Endowed Funds

<div class="row">

  <div class="col-sm-7">

```{r endow-fund-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r endow-fund-table}
plot(cars)
```

  </div>
  
</div>

### Expendable Gifts

<div class="row">

  <div class="col-sm-7">

```{r expend-gift-plot}
plot(cars)
```

  </div>
  
  <div class="col-sm-5">

```{r expend-gift-table}
plot(cars)
```

  </div>
  
</div>

<hr/>


Special thanks to **ACKNOWLEDGEMENTS HERE**


